---
export interface Props {
  publicId: string
  alt: string
  width?: number
  height?: number
  crop?: 'fill' | 'fit' | 'scale' | 'crop'
  quality?: 'auto' | number
  format?: 'auto' | 'webp' | 'jpg' | 'png'
  className?: string
  sizes?: string
}

const {
  publicId,
  alt,
  width,
  height,
  crop = 'fill',
  quality = 'auto',
  format = 'auto',
  className = '',
  sizes = '100vw'
} = Astro.props

// Generate Cloudinary URL
function getCloudinaryUrl(publicId: string, options: any) {
  const cloudName = import.meta.env.CLOUDINARY_CLOUD_NAME || 'your-cloud-name'
  let url = `https://res.cloudinary.com/${cloudName}/image/upload`
  
  const transformations = []
  if (options.width) transformations.push(`w_${options.width}`)
  if (options.height) transformations.push(`h_${options.height}`)
  if (options.crop) transformations.push(`c_${options.crop}`)
  if (options.quality) transformations.push(`q_${options.quality}`)
  if (options.format) transformations.push(`f_${options.format}`)
  
  if (transformations.length > 0) {
    url += `/${transformations.join(',')}`
  }
  
  url += `/${publicId}`
  return url
}

// Generate responsive image URLs
const baseUrl = getCloudinaryUrl(publicId, { crop, quality, format })
const mobileUrl = getCloudinaryUrl(publicId, { width: 400, crop, quality, format })
const tabletUrl = getCloudinaryUrl(publicId, { width: 800, crop, quality, format })
const desktopUrl = getCloudinaryUrl(publicId, { width: 1200, crop, quality, format })

// Generate srcset
const srcset = `${mobileUrl} 400w, ${tabletUrl} 800w, ${desktopUrl} 1200w`
---

<img
  src={baseUrl}
  srcset={srcset}
  sizes={sizes}
  alt={alt}
  class={className}
  loading="lazy"
  decoding="async"
/>
