---
export interface Props {
  publicId: string
  alt: string
  width?: number
  height?: number
  crop?: 'fill' | 'fit' | 'scale' | 'crop'
  quality?: 'auto' | number
  format?: 'auto' | 'webp' | 'jpg' | 'png'
  className?: string
  sizes?: string
}

const {
  publicId,
  alt,
  width,
  height,
  crop = 'fill',
  quality = 'auto',
  format = 'auto',
  className = '',
  sizes = '100vw'
} = Astro.props

// Import utility functions
const { getCloudinaryUrl } = await import('../lib/cloudinary-utils')

// Generate responsive image URLs
const baseUrl = getCloudinaryUrl(publicId, { width, height, crop, quality, format })
const mobileUrl = getCloudinaryUrl(publicId, { width: 400, crop, quality, format })
const tabletUrl = getCloudinaryUrl(publicId, { width: 800, crop, quality, format })
const desktopUrl = getCloudinaryUrl(publicId, { width: 1200, crop, quality, format })

// Generate srcset
const srcset = `${mobileUrl} 400w, ${tabletUrl} 800w, ${desktopUrl} 1200w`
---

<img
  src={baseUrl}
  srcset={srcset}
  sizes={sizes}
  alt={alt}
  class={className}
  loading="lazy"
  decoding="async"
/>
